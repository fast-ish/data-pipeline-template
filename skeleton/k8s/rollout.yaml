{%- if values.pipelineType == "streaming" %}
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: ${{values.name}}
  labels:
    app.kubernetes.io/name: ${{values.name}}
    app.kubernetes.io/component: data-pipeline
    fasti.sh/template: data-pipeline
    fasti.sh/pipeline-type: streaming
spec:
  replicas: 2
  revisionHistoryLimit: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: ${{values.name}}
  template:
    metadata:
      labels:
        app.kubernetes.io/name: ${{values.name}}
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "8000"
    spec:
      serviceAccountName: ${{values.owner | replace("group:", "") | replace("team-", "")}}-workload
      containers:
        - name: ${{values.name}}
          image: IMAGE_PLACEHOLDER:latest
          resources:
            requests:
              cpu: "500m"
              memory: "1Gi"
            limits:
              cpu: "2000m"
              memory: "4Gi"
          livenessProbe:
            httpGet:
              path: /health
              port: 8000
            initialDelaySeconds: 30
            periodSeconds: 30
  strategy:
    blueGreen:
      activeService: ${{values.name}}
      previewService: ${{values.name}}-preview
      autoPromotionEnabled: true
      autoPromotionSeconds: 120
      scaleDownDelaySeconds: 30
{%- else %}
# Batch pipelines are orchestrated by ${{values.orchestrator}}.
# See the DAG/workflow definitions in the pipeline code.
#
# For job-based execution, use Kubernetes CronJob or Argo Workflows:
apiVersion: batch/v1
kind: CronJob
metadata:
  name: ${{values.name}}
  labels:
    app.kubernetes.io/name: ${{values.name}}
    fasti.sh/template: data-pipeline
    fasti.sh/pipeline-type: batch
spec:
  schedule: "0 0 * * *"  # Daily at midnight - customize as needed
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: ${{values.owner | replace("group:", "") | replace("team-", "")}}-workload
          restartPolicy: OnFailure
          containers:
            - name: ${{values.name}}
              image: IMAGE_PLACEHOLDER:latest
              resources:
                requests:
                  cpu: "1000m"
                  memory: "2Gi"
                limits:
                  cpu: "4000m"
                  memory: "8Gi"
{%- endif %}
